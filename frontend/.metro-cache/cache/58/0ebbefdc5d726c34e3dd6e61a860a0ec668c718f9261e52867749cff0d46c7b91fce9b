{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"socket.io-client","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":46,"index":46}}],"key":"LVgCyxgUdze/lYG0kA6DdCAztfM=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  Object.defineProperty(exports, \"socketService\", {\n    enumerable: true,\n    get: function () {\n      return socketService;\n    }\n  });\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _socketIoClient = require(_dependencyMap[1], \"socket.io-client\");\n  const API_BASE_URL = _expoVirtualEnv.env.EXPO_PUBLIC_BACKEND_URL || '';\n  class SocketService {\n    socket = null;\n    tenantId = null;\n    onNewAlert = null;\n    onEventUpdated = null;\n    reconnectAttempts = 0;\n    maxReconnectAttempts = 5;\n    connect(tenantId, token) {\n      if (this.socket?.connected && this.tenantId === tenantId) {\n        console.log('[Socket] Already connected to tenant:', tenantId);\n        return;\n      }\n      this.disconnect();\n      this.tenantId = tenantId;\n      console.log('[Socket] Connecting to:', `${API_BASE_URL}/api/socket.io`);\n      this.socket = (0, _socketIoClient.io)(API_BASE_URL, {\n        path: '/api/socket.io',\n        transports: ['websocket', 'polling'],\n        auth: {\n          token\n        },\n        reconnection: true,\n        reconnectionAttempts: this.maxReconnectAttempts,\n        reconnectionDelay: 1000,\n        reconnectionDelayMax: 5000\n      });\n      this.setupEventListeners();\n    }\n    setupEventListeners() {\n      if (!this.socket) return;\n      this.socket.on('connect', () => {\n        console.log('[Socket] Connected');\n        this.reconnectAttempts = 0;\n        // Join tenant room\n        if (this.tenantId) {\n          this.socket?.emit('join_tenant', {\n            tenant_id: this.tenantId\n          });\n        }\n      });\n      this.socket.on('disconnect', reason => {\n        console.log('[Socket] Disconnected:', reason);\n      });\n      this.socket.on('connect_error', error => {\n        console.error('[Socket] Connection error:', error.message);\n        this.reconnectAttempts++;\n      });\n      this.socket.on('joined', data => {\n        console.log('[Socket] Joined room:', data);\n      });\n\n      // Listen for new events\n      this.socket.on('new_event', data => {\n        console.log('[Socket] New event received:', data.event?.id);\n        if (this.onNewAlert && data.event) {\n          // Only notify for FALL events (critical alerts)\n          if (data.event.type === 'FALL' || data.event.type === 'PRE_FALL') {\n            this.onNewAlert(data.event);\n          }\n        }\n      });\n      this.socket.on('new_radar_event', data => {\n        console.log('[Socket] New radar event received:', data.event?.id);\n        if (this.onNewAlert && data.event) {\n          if (data.event.type === 'FALL' || data.event.type === 'PRE_FALL') {\n            this.onNewAlert(data.event);\n          }\n        }\n      });\n\n      // Listen for event updates\n      this.socket.on('event_updated', data => {\n        console.log('[Socket] Event updated:', data.event_id);\n        if (this.onEventUpdated) {\n          this.onEventUpdated(data);\n        }\n      });\n    }\n    disconnect() {\n      if (this.socket) {\n        if (this.tenantId) {\n          this.socket.emit('leave_tenant', {\n            tenant_id: this.tenantId\n          });\n        }\n        this.socket.disconnect();\n        this.socket = null;\n      }\n      this.tenantId = null;\n    }\n    setOnNewAlert(callback) {\n      this.onNewAlert = callback;\n    }\n    setOnEventUpdated(callback) {\n      this.onEventUpdated = callback;\n    }\n    isConnected() {\n      return this.socket?.connected ?? false;\n    }\n  }\n  const socketService = new SocketService();\n  var _default = socketService;\n});","lineCount":124,"map":[[7,2,117,0,"Object"],[7,8,117,0],[7,9,117,0,"defineProperty"],[7,23,117,0],[7,24,117,0,"exports"],[7,31,117,0],[8,4,117,0,"enumerable"],[8,14,117,0],[9,4,117,0,"get"],[9,7,117,0],[9,18,117,0,"get"],[9,19,117,0],[10,6,117,0],[10,13,117,0,"_default"],[10,21,117,0],[11,4,117,0],[12,2,117,0],[13,2,116,0,"Object"],[13,8,116,0],[13,9,116,0,"defineProperty"],[13,23,116,0],[13,24,116,0,"exports"],[13,31,116,0],[14,4,116,0,"enumerable"],[14,14,116,0],[15,4,116,0,"get"],[15,7,116,0],[15,18,116,0,"get"],[15,19,116,0],[16,6,116,0],[16,13,116,0,"socketService"],[16,26,116,0],[17,4,116,0],[18,2,116,0],[19,2,116,49],[19,6,116,49,"_expoVirtualEnv"],[19,21,116,49],[19,24,116,49,"require"],[19,31,116,49],[19,32,116,49,"_dependencyMap"],[19,46,116,49],[20,2,1,0],[20,6,1,0,"_socketIoClient"],[20,21,1,0],[20,24,1,0,"require"],[20,31,1,0],[20,32,1,0,"_dependencyMap"],[20,46,1,0],[21,2,4,0],[21,8,4,6,"API_BASE_URL"],[21,20,4,18],[21,23,4,21,"_expoVirtualEnv"],[21,38,4,21],[21,39,4,21,"env"],[21,42,4,21],[21,43,4,21,"EXPO_PUBLIC_BACKEND_URL"],[21,66,4,21],[21,70,4,60],[21,72,4,62],[22,2,6,0],[22,8,6,6,"SocketService"],[22,21,6,19],[22,22,6,20],[23,4,7,10,"socket"],[23,10,7,16],[23,13,7,34],[23,17,7,38],[24,4,8,10,"tenantId"],[24,12,8,18],[24,15,8,36],[24,19,8,40],[25,4,9,10,"onNewAlert"],[25,14,9,20],[25,17,9,56],[25,21,9,60],[26,4,10,10,"onEventUpdated"],[26,18,10,24],[26,21,10,87],[26,25,10,91],[27,4,11,10,"reconnectAttempts"],[27,21,11,27],[27,24,11,30],[27,25,11,31],[28,4,12,10,"maxReconnectAttempts"],[28,24,12,30],[28,27,12,33],[28,28,12,34],[29,4,14,2,"connect"],[29,11,14,9,"connect"],[29,12,14,10,"tenantId"],[29,20,14,26],[29,22,14,28,"token"],[29,27,14,41],[29,29,14,49],[30,6,15,4],[30,10,15,8],[30,14,15,12],[30,15,15,13,"socket"],[30,21,15,19],[30,23,15,21,"connected"],[30,32,15,30],[30,36,15,34],[30,40,15,38],[30,41,15,39,"tenantId"],[30,49,15,47],[30,54,15,52,"tenantId"],[30,62,15,60],[30,64,15,62],[31,8,16,6,"console"],[31,15,16,13],[31,16,16,14,"log"],[31,19,16,17],[31,20,16,18],[31,59,16,57],[31,61,16,59,"tenantId"],[31,69,16,67],[31,70,16,68],[32,8,17,6],[33,6,18,4],[34,6,20,4],[34,10,20,8],[34,11,20,9,"disconnect"],[34,21,20,19],[34,22,20,20],[34,23,20,21],[35,6,21,4],[35,10,21,8],[35,11,21,9,"tenantId"],[35,19,21,17],[35,22,21,20,"tenantId"],[35,30,21,28],[36,6,23,4,"console"],[36,13,23,11],[36,14,23,12,"log"],[36,17,23,15],[36,18,23,16],[36,43,23,41],[36,45,23,43],[36,48,23,46,"API_BASE_URL"],[36,60,23,58],[36,76,23,74],[36,77,23,75],[37,6,25,4],[37,10,25,8],[37,11,25,9,"socket"],[37,17,25,15],[37,20,25,18],[37,24,25,18,"io"],[37,39,25,20],[37,40,25,20,"io"],[37,42,25,20],[37,44,25,21,"API_BASE_URL"],[37,56,25,33],[37,58,25,35],[38,8,26,6,"path"],[38,12,26,10],[38,14,26,12],[38,30,26,28],[39,8,27,6,"transports"],[39,18,27,16],[39,20,27,18],[39,21,27,19],[39,32,27,30],[39,34,27,32],[39,43,27,41],[39,44,27,42],[40,8,28,6,"auth"],[40,12,28,10],[40,14,28,12],[41,10,28,14,"token"],[42,8,28,20],[42,9,28,21],[43,8,29,6,"reconnection"],[43,20,29,18],[43,22,29,20],[43,26,29,24],[44,8,30,6,"reconnectionAttempts"],[44,28,30,26],[44,30,30,28],[44,34,30,32],[44,35,30,33,"maxReconnectAttempts"],[44,55,30,53],[45,8,31,6,"reconnectionDelay"],[45,25,31,23],[45,27,31,25],[45,31,31,29],[46,8,32,6,"reconnectionDelayMax"],[46,28,32,26],[46,30,32,28],[47,6,33,4],[47,7,33,5],[47,8,33,6],[48,6,35,4],[48,10,35,8],[48,11,35,9,"setupEventListeners"],[48,30,35,28],[48,31,35,29],[48,32,35,30],[49,4,36,2],[50,4,38,10,"setupEventListeners"],[50,23,38,29,"setupEventListeners"],[50,24,38,29],[50,26,38,38],[51,6,39,4],[51,10,39,8],[51,11,39,9],[51,15,39,13],[51,16,39,14,"socket"],[51,22,39,20],[51,24,39,22],[52,6,41,4],[52,10,41,8],[52,11,41,9,"socket"],[52,17,41,15],[52,18,41,16,"on"],[52,20,41,18],[52,21,41,19],[52,30,41,28],[52,32,41,30],[52,38,41,36],[53,8,42,6,"console"],[53,15,42,13],[53,16,42,14,"log"],[53,19,42,17],[53,20,42,18],[53,40,42,38],[53,41,42,39],[54,8,43,6],[54,12,43,10],[54,13,43,11,"reconnectAttempts"],[54,30,43,28],[54,33,43,31],[54,34,43,32],[55,8,44,6],[56,8,45,6],[56,12,45,10],[56,16,45,14],[56,17,45,15,"tenantId"],[56,25,45,23],[56,27,45,25],[57,10,46,8],[57,14,46,12],[57,15,46,13,"socket"],[57,21,46,19],[57,23,46,21,"emit"],[57,27,46,25],[57,28,46,26],[57,41,46,39],[57,43,46,41],[58,12,46,43,"tenant_id"],[58,21,46,52],[58,23,46,54],[58,27,46,58],[58,28,46,59,"tenantId"],[59,10,46,68],[59,11,46,69],[59,12,46,70],[60,8,47,6],[61,6,48,4],[61,7,48,5],[61,8,48,6],[62,6,50,4],[62,10,50,8],[62,11,50,9,"socket"],[62,17,50,15],[62,18,50,16,"on"],[62,20,50,18],[62,21,50,19],[62,33,50,31],[62,35,50,34,"reason"],[62,41,50,40],[62,45,50,45],[63,8,51,6,"console"],[63,15,51,13],[63,16,51,14,"log"],[63,19,51,17],[63,20,51,18],[63,44,51,42],[63,46,51,44,"reason"],[63,52,51,50],[63,53,51,51],[64,6,52,4],[64,7,52,5],[64,8,52,6],[65,6,54,4],[65,10,54,8],[65,11,54,9,"socket"],[65,17,54,15],[65,18,54,16,"on"],[65,20,54,18],[65,21,54,19],[65,36,54,34],[65,38,54,37,"error"],[65,43,54,42],[65,47,54,47],[66,8,55,6,"console"],[66,15,55,13],[66,16,55,14,"error"],[66,21,55,19],[66,22,55,20],[66,50,55,48],[66,52,55,50,"error"],[66,57,55,55],[66,58,55,56,"message"],[66,65,55,63],[66,66,55,64],[67,8,56,6],[67,12,56,10],[67,13,56,11,"reconnectAttempts"],[67,30,56,28],[67,32,56,30],[68,6,57,4],[68,7,57,5],[68,8,57,6],[69,6,59,4],[69,10,59,8],[69,11,59,9,"socket"],[69,17,59,15],[69,18,59,16,"on"],[69,20,59,18],[69,21,59,19],[69,29,59,27],[69,31,59,30,"data"],[69,35,59,34],[69,39,59,39],[70,8,60,6,"console"],[70,15,60,13],[70,16,60,14,"log"],[70,19,60,17],[70,20,60,18],[70,43,60,41],[70,45,60,43,"data"],[70,49,60,47],[70,50,60,48],[71,6,61,4],[71,7,61,5],[71,8,61,6],[73,6,63,4],[74,6,64,4],[74,10,64,8],[74,11,64,9,"socket"],[74,17,64,15],[74,18,64,16,"on"],[74,20,64,18],[74,21,64,19],[74,32,64,30],[74,34,64,33,"data"],[74,38,64,69],[74,42,64,74],[75,8,65,6,"console"],[75,15,65,13],[75,16,65,14,"log"],[75,19,65,17],[75,20,65,18],[75,50,65,48],[75,52,65,50,"data"],[75,56,65,54],[75,57,65,55,"event"],[75,62,65,60],[75,64,65,62,"id"],[75,66,65,64],[75,67,65,65],[76,8,66,6],[76,12,66,10],[76,16,66,14],[76,17,66,15,"onNewAlert"],[76,27,66,25],[76,31,66,29,"data"],[76,35,66,33],[76,36,66,34,"event"],[76,41,66,39],[76,43,66,41],[77,10,67,8],[78,10,68,8],[78,14,68,12,"data"],[78,18,68,16],[78,19,68,17,"event"],[78,24,68,22],[78,25,68,23,"type"],[78,29,68,27],[78,34,68,32],[78,40,68,38],[78,44,68,42,"data"],[78,48,68,46],[78,49,68,47,"event"],[78,54,68,52],[78,55,68,53,"type"],[78,59,68,57],[78,64,68,62],[78,74,68,72],[78,76,68,74],[79,12,69,10],[79,16,69,14],[79,17,69,15,"onNewAlert"],[79,27,69,25],[79,28,69,26,"data"],[79,32,69,30],[79,33,69,31,"event"],[79,38,69,36],[79,39,69,37],[80,10,70,8],[81,8,71,6],[82,6,72,4],[82,7,72,5],[82,8,72,6],[83,6,74,4],[83,10,74,8],[83,11,74,9,"socket"],[83,17,74,15],[83,18,74,16,"on"],[83,20,74,18],[83,21,74,19],[83,38,74,36],[83,40,74,39,"data"],[83,44,74,75],[83,48,74,80],[84,8,75,6,"console"],[84,15,75,13],[84,16,75,14,"log"],[84,19,75,17],[84,20,75,18],[84,56,75,54],[84,58,75,56,"data"],[84,62,75,60],[84,63,75,61,"event"],[84,68,75,66],[84,70,75,68,"id"],[84,72,75,70],[84,73,75,71],[85,8,76,6],[85,12,76,10],[85,16,76,14],[85,17,76,15,"onNewAlert"],[85,27,76,25],[85,31,76,29,"data"],[85,35,76,33],[85,36,76,34,"event"],[85,41,76,39],[85,43,76,41],[86,10,77,8],[86,14,77,12,"data"],[86,18,77,16],[86,19,77,17,"event"],[86,24,77,22],[86,25,77,23,"type"],[86,29,77,27],[86,34,77,32],[86,40,77,38],[86,44,77,42,"data"],[86,48,77,46],[86,49,77,47,"event"],[86,54,77,52],[86,55,77,53,"type"],[86,59,77,57],[86,64,77,62],[86,74,77,72],[86,76,77,74],[87,12,78,10],[87,16,78,14],[87,17,78,15,"onNewAlert"],[87,27,78,25],[87,28,78,26,"data"],[87,32,78,30],[87,33,78,31,"event"],[87,38,78,36],[87,39,78,37],[88,10,79,8],[89,8,80,6],[90,6,81,4],[90,7,81,5],[90,8,81,6],[92,6,83,4],[93,6,84,4],[93,10,84,8],[93,11,84,9,"socket"],[93,17,84,15],[93,18,84,16,"on"],[93,20,84,18],[93,21,84,19],[93,36,84,34],[93,38,84,37,"data"],[93,42,84,90],[93,46,84,95],[94,8,85,6,"console"],[94,15,85,13],[94,16,85,14,"log"],[94,19,85,17],[94,20,85,18],[94,45,85,43],[94,47,85,45,"data"],[94,51,85,49],[94,52,85,50,"event_id"],[94,60,85,58],[94,61,85,59],[95,8,86,6],[95,12,86,10],[95,16,86,14],[95,17,86,15,"onEventUpdated"],[95,31,86,29],[95,33,86,31],[96,10,87,8],[96,14,87,12],[96,15,87,13,"onEventUpdated"],[96,29,87,27],[96,30,87,28,"data"],[96,34,87,32],[96,35,87,33],[97,8,88,6],[98,6,89,4],[98,7,89,5],[98,8,89,6],[99,4,90,2],[100,4,92,2,"disconnect"],[100,14,92,12,"disconnect"],[100,15,92,12],[100,17,92,21],[101,6,93,4],[101,10,93,8],[101,14,93,12],[101,15,93,13,"socket"],[101,21,93,19],[101,23,93,21],[102,8,94,6],[102,12,94,10],[102,16,94,14],[102,17,94,15,"tenantId"],[102,25,94,23],[102,27,94,25],[103,10,95,8],[103,14,95,12],[103,15,95,13,"socket"],[103,21,95,19],[103,22,95,20,"emit"],[103,26,95,24],[103,27,95,25],[103,41,95,39],[103,43,95,41],[104,12,95,43,"tenant_id"],[104,21,95,52],[104,23,95,54],[104,27,95,58],[104,28,95,59,"tenantId"],[105,10,95,68],[105,11,95,69],[105,12,95,70],[106,8,96,6],[107,8,97,6],[107,12,97,10],[107,13,97,11,"socket"],[107,19,97,17],[107,20,97,18,"disconnect"],[107,30,97,28],[107,31,97,29],[107,32,97,30],[108,8,98,6],[108,12,98,10],[108,13,98,11,"socket"],[108,19,98,17],[108,22,98,20],[108,26,98,24],[109,6,99,4],[110,6,100,4],[110,10,100,8],[110,11,100,9,"tenantId"],[110,19,100,17],[110,22,100,20],[110,26,100,24],[111,4,101,2],[112,4,103,2,"setOnNewAlert"],[112,17,103,15,"setOnNewAlert"],[112,18,103,16,"callback"],[112,26,103,57],[112,28,103,65],[113,6,104,4],[113,10,104,8],[113,11,104,9,"onNewAlert"],[113,21,104,19],[113,24,104,22,"callback"],[113,32,104,30],[114,4,105,2],[115,4,107,2,"setOnEventUpdated"],[115,21,107,19,"setOnEventUpdated"],[115,22,107,20,"callback"],[115,30,107,88],[115,32,107,96],[116,6,108,4],[116,10,108,8],[116,11,108,9,"onEventUpdated"],[116,25,108,23],[116,28,108,26,"callback"],[116,36,108,34],[117,4,109,2],[118,4,111,2,"isConnected"],[118,15,111,13,"isConnected"],[118,16,111,13],[118,18,111,25],[119,6,112,4],[119,13,112,11],[119,17,112,15],[119,18,112,16,"socket"],[119,24,112,22],[119,26,112,24,"connected"],[119,35,112,33],[119,39,112,37],[119,44,112,42],[120,4,113,2],[121,2,114,0],[122,2,116,7],[122,8,116,13,"socketService"],[122,21,116,26],[122,24,116,29],[122,28,116,33,"SocketService"],[122,41,116,46],[122,42,116,47],[122,43,116,48],[123,2,117,0],[123,6,117,0,"_default"],[123,14,117,0],[123,17,117,15,"socketService"],[123,30,117,28],[124,0,117,29],[124,3]],"functionMap":{"names":["<global>","SocketService","SocketService#connect","SocketService#setupEventListeners","on$argument_1","SocketService#disconnect","SocketService#setOnNewAlert","SocketService#setOnEventUpdated","SocketService#isConnected"],"mappings":"AAA;ACK;ECQ;GDsB;EEE;8BCG;KDO;iCCE;KDE;oCCE;KDG;6BCE;KDE;gCCG;KDQ;sCCE;KDO;oCCG;KDK;GFC;EIE;GJS;EKE;GLE;EME;GNE;EOE;GPE;CDC"},"hasCjsExports":false},"type":"js/module"}]}