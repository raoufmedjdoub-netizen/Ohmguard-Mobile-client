{"dependencies":[{"name":"zustand","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":33,"index":33}}],"key":"POPvx7yS3Y3wz+S/9OAefiXNs0Q=","exportNames":["*"],"imports":1}},{"name":"../services/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":67},"end":{"line":3,"column":65,"index":132}}],"key":"Pr5/EB33W7mJGi+ygccy+pUf1E8=","exportNames":["*"],"imports":1}},{"name":"../services/socket","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":133},"end":{"line":4,"column":47,"index":180}}],"key":"Zr9DRnwDVZxHFeGDyPwyujLo6pk=","exportNames":["*"],"imports":1}},{"name":"react-native-web/dist/exports/Platform","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dV3bI3NOD8bfMzaIniMaFGy/nn8=","exportNames":["*"],"imports":1}},{"name":"../services/pushNotifications","data":{"asyncType":"async","isESMImport":true,"locs":[{"start":{"line":34,"column":48,"index":1058},"end":{"line":34,"column":87,"index":1097}},{"start":{"line":91,"column":48,"index":2903},"end":{"line":91,"column":87,"index":2942}}],"key":"vxFd3ptrTRpoCG9vu8Tu5SZCg9Y=","exportNames":["*"],"imports":2,"isOptional":true}},{"name":"expo/internal/async-require-module","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":34,"column":42,"index":1052},"end":{"line":34,"column":87,"index":1097}},{"start":{"line":91,"column":42,"index":2897},"end":{"line":91,"column":87,"index":2942}}],"key":"y8mhXL4zKvSVvgnacXXOn0UU+QQ=","exportNames":["*"],"imports":2}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"useAuthStore\", {\n    enumerable: true,\n    get: function () {\n      return useAuthStore;\n    }\n  });\n  var _zustand = require(_dependencyMap[0], \"zustand\");\n  var _servicesApi = require(_dependencyMap[1], \"../services/api\");\n  var _servicesSocket = require(_dependencyMap[2], \"../services/socket\");\n  var socketService = _interopDefault(_servicesSocket);\n  var _reactNativeWebDistExportsPlatform = require(_dependencyMap[3], \"react-native-web/dist/exports/Platform\");\n  var Platform = _interopDefault(_reactNativeWebDistExportsPlatform);\n  const useAuthStore = (0, _zustand.create)((set, get) => ({\n    user: null,\n    isAuthenticated: false,\n    isInitializing: true,\n    isSubmitting: false,\n    error: null,\n    pushToken: null,\n    initializePushNotifications: async () => {\n      try {\n        // Dynamically import push notification service to avoid module loading issues\n        const {\n          pushNotificationService\n        } = await require(_dependencyMap[5], \"expo/internal/async-require-module\")(_dependencyMap[4], _dependencyMap.paths, \"../services/pushNotifications\");\n        const token = await pushNotificationService.initialize();\n        if (token) {\n          set({\n            pushToken: token\n          });\n          // Register the token with the backend\n          try {\n            await _servicesApi.pushApi.registerToken(token, Platform.default.OS);\n            console.log('[Auth] Push token registered with backend');\n          } catch (error) {\n            console.error('[Auth] Failed to register push token:', error);\n          }\n        }\n      } catch (error) {\n        console.log('[Auth] Push notifications not available:', error);\n      }\n    },\n    login: async (email, password) => {\n      set({\n        isSubmitting: true,\n        error: null\n      });\n      try {\n        await _servicesApi.authApi.login({\n          email,\n          password\n        });\n        const user = await _servicesApi.authApi.getCurrentUser();\n\n        // Connect to WebSocket\n        const token = await _servicesApi.tokenManager.getAccessToken();\n        if (user.tenant_id && token) {\n          socketService.default.connect(user.tenant_id, token);\n        }\n        set({\n          user,\n          isAuthenticated: true,\n          isSubmitting: false\n        });\n\n        // Initialize push notifications after successful login (delayed)\n        setTimeout(() => {\n          get().initializePushNotifications();\n        }, 1000);\n        return true;\n      } catch (error) {\n        const message = error.response?.data?.detail || 'Erreur de connexion';\n        set({\n          error: message,\n          isSubmitting: false\n        });\n        return false;\n      }\n    },\n    logout: async () => {\n      // Unregister push token before logout\n      const {\n        pushToken\n      } = get();\n      if (pushToken) {\n        try {\n          await _servicesApi.pushApi.deleteToken(pushToken);\n        } catch (error) {\n          console.error('[Auth] Failed to delete push token:', error);\n        }\n      }\n\n      // Clean up push notification service\n      try {\n        const {\n          pushNotificationService\n        } = await require(_dependencyMap[5], \"expo/internal/async-require-module\")(_dependencyMap[4], _dependencyMap.paths, \"../services/pushNotifications\");\n        pushNotificationService.cleanup();\n      } catch (error) {\n        // Ignore if not available\n      }\n      socketService.default.disconnect();\n      await _servicesApi.authApi.logout();\n      set({\n        user: null,\n        isAuthenticated: false,\n        error: null,\n        pushToken: null\n      });\n    },\n    checkAuth: async () => {\n      set({\n        isInitializing: true\n      });\n      try {\n        const token = await _servicesApi.tokenManager.getAccessToken();\n        if (!token) {\n          set({\n            isInitializing: false,\n            isAuthenticated: false\n          });\n          return false;\n        }\n        const user = await _servicesApi.authApi.getCurrentUser();\n\n        // Connect to WebSocket\n        if (user.tenant_id) {\n          socketService.default.connect(user.tenant_id, token);\n        }\n        set({\n          user,\n          isAuthenticated: true,\n          isInitializing: false\n        });\n\n        // Initialize push notifications (delayed)\n        setTimeout(() => {\n          get().initializePushNotifications();\n        }, 1000);\n        return true;\n      } catch (error) {\n        await _servicesApi.tokenManager.clearTokens();\n        set({\n          user: null,\n          isAuthenticated: false,\n          isInitializing: false\n        });\n        return false;\n      }\n    },\n    clearError: () => set({\n      error: null\n    })\n  }));\n});","lineCount":166,"map":[[12,2,23,0,"Object"],[12,8,23,0],[12,9,23,0,"defineProperty"],[12,23,23,0],[12,24,23,0,"exports"],[12,31,23,0],[13,4,23,0,"enumerable"],[13,14,23,0],[14,4,23,0,"get"],[14,7,23,0],[14,18,23,0,"get"],[14,19,23,0],[15,6,23,0],[15,13,23,0,"useAuthStore"],[15,25,23,0],[16,4,23,0],[17,2,23,0],[18,2,1,0],[18,6,1,0,"_zustand"],[18,14,1,0],[18,17,1,0,"require"],[18,24,1,0],[18,25,1,0,"_dependencyMap"],[18,39,1,0],[19,2,3,0],[19,6,3,0,"_servicesApi"],[19,18,3,0],[19,21,3,0,"require"],[19,28,3,0],[19,29,3,0,"_dependencyMap"],[19,43,3,0],[20,2,4,0],[20,6,4,0,"_servicesSocket"],[20,21,4,0],[20,24,4,0,"require"],[20,31,4,0],[20,32,4,0,"_dependencyMap"],[20,46,4,0],[21,2,4,0],[21,6,4,0,"socketService"],[21,19,4,0],[21,22,4,0,"_interopDefault"],[21,37,4,0],[21,38,4,0,"_servicesSocket"],[21,53,4,0],[22,2,4,47],[22,6,4,47,"_reactNativeWebDistExportsPlatform"],[22,40,4,47],[22,43,4,47,"require"],[22,50,4,47],[22,51,4,47,"_dependencyMap"],[22,65,4,47],[23,2,4,47],[23,6,4,47,"Platform"],[23,14,4,47],[23,17,4,47,"_interopDefault"],[23,32,4,47],[23,33,4,47,"_reactNativeWebDistExportsPlatform"],[23,67,4,47],[24,2,23,7],[24,8,23,13,"useAuthStore"],[24,20,23,25],[24,23,23,28],[24,27,23,28,"create"],[24,35,23,34],[24,36,23,34,"create"],[24,42,23,34],[24,44,23,46],[24,45,23,47,"set"],[24,48,23,50],[24,50,23,52,"get"],[24,53,23,55],[24,59,23,61],[25,4,24,2,"user"],[25,8,24,6],[25,10,24,8],[25,14,24,12],[26,4,25,2,"isAuthenticated"],[26,19,25,17],[26,21,25,19],[26,26,25,24],[27,4,26,2,"isInitializing"],[27,18,26,16],[27,20,26,18],[27,24,26,22],[28,4,27,2,"isSubmitting"],[28,16,27,14],[28,18,27,16],[28,23,27,21],[29,4,28,2,"error"],[29,9,28,7],[29,11,28,9],[29,15,28,13],[30,4,29,2,"pushToken"],[30,13,29,11],[30,15,29,13],[30,19,29,17],[31,4,31,2,"initializePushNotifications"],[31,31,31,29],[31,33,31,31],[31,39,31,31,"initializePushNotifications"],[31,40,31,31],[31,45,31,43],[32,6,32,4],[32,10,32,8],[33,8,33,6],[34,8,34,6],[34,14,34,12],[35,10,34,14,"pushNotificationService"],[36,8,34,38],[36,9,34,39],[36,12,34,42],[36,18,34,42,"require"],[36,25,34,42],[36,26,34,42,"_dependencyMap"],[36,40,34,42],[36,83,34,42,"_dependencyMap"],[36,97,34,42],[36,102,34,42,"_dependencyMap"],[36,116,34,42],[36,117,34,42,"paths"],[36,122,34,42],[36,156,34,87],[37,8,35,6],[37,14,35,12,"token"],[37,19,35,17],[37,22,35,20],[37,28,35,26,"pushNotificationService"],[37,51,35,49],[37,52,35,50,"initialize"],[37,62,35,60],[37,63,35,61],[37,64,35,62],[38,8,36,6],[38,12,36,10,"token"],[38,17,36,15],[38,19,36,17],[39,10,37,8,"set"],[39,13,37,11],[39,14,37,12],[40,12,37,14,"pushToken"],[40,21,37,23],[40,23,37,25,"token"],[41,10,37,31],[41,11,37,32],[41,12,37,33],[42,10,38,8],[43,10,39,8],[43,14,39,12],[44,12,40,10],[44,18,40,16,"pushApi"],[44,30,40,23],[44,31,40,23,"pushApi"],[44,38,40,23],[44,39,40,24,"registerToken"],[44,52,40,37],[44,53,40,38,"token"],[44,58,40,43],[44,60,40,45,"Platform"],[44,68,40,53],[44,69,40,53,"default"],[44,76,40,53],[44,77,40,54,"OS"],[44,79,40,56],[44,80,40,57],[45,12,41,10,"console"],[45,19,41,17],[45,20,41,18,"log"],[45,23,41,21],[45,24,41,22],[45,67,41,65],[45,68,41,66],[46,10,42,8],[46,11,42,9],[46,12,42,10],[46,19,42,17,"error"],[46,24,42,22],[46,26,42,24],[47,12,43,10,"console"],[47,19,43,17],[47,20,43,18,"error"],[47,25,43,23],[47,26,43,24],[47,65,43,63],[47,67,43,65,"error"],[47,72,43,70],[47,73,43,71],[48,10,44,8],[49,8,45,6],[50,6,46,4],[50,7,46,5],[50,8,46,6],[50,15,46,13,"error"],[50,20,46,18],[50,22,46,20],[51,8,47,6,"console"],[51,15,47,13],[51,16,47,14,"log"],[51,19,47,17],[51,20,47,18],[51,62,47,60],[51,64,47,62,"error"],[51,69,47,67],[51,70,47,68],[52,6,48,4],[53,4,49,2],[53,5,49,3],[54,4,51,2,"login"],[54,9,51,7],[54,11,51,9],[54,17,51,9,"login"],[54,18,51,16,"email"],[54,23,51,29],[54,25,51,31,"password"],[54,33,51,47],[54,38,51,70],[55,6,52,4,"set"],[55,9,52,7],[55,10,52,8],[56,8,52,10,"isSubmitting"],[56,20,52,22],[56,22,52,24],[56,26,52,28],[57,8,52,30,"error"],[57,13,52,35],[57,15,52,37],[58,6,52,42],[58,7,52,43],[58,8,52,44],[59,6,53,4],[59,10,53,8],[60,8,54,6],[60,14,54,12,"authApi"],[60,26,54,19],[60,27,54,19,"authApi"],[60,34,54,19],[60,35,54,20,"login"],[60,40,54,25],[60,41,54,26],[61,10,54,28,"email"],[61,15,54,33],[62,10,54,35,"password"],[63,8,54,44],[63,9,54,45],[63,10,54,46],[64,8,55,6],[64,14,55,12,"user"],[64,18,55,16],[64,21,55,19],[64,27,55,25,"authApi"],[64,39,55,32],[64,40,55,32,"authApi"],[64,47,55,32],[64,48,55,33,"getCurrentUser"],[64,62,55,47],[64,63,55,48],[64,64,55,49],[66,8,57,6],[67,8,58,6],[67,14,58,12,"token"],[67,19,58,17],[67,22,58,20],[67,28,58,26,"tokenManager"],[67,40,58,38],[67,41,58,38,"tokenManager"],[67,53,58,38],[67,54,58,39,"getAccessToken"],[67,68,58,53],[67,69,58,54],[67,70,58,55],[68,8,59,6],[68,12,59,10,"user"],[68,16,59,14],[68,17,59,15,"tenant_id"],[68,26,59,24],[68,30,59,28,"token"],[68,35,59,33],[68,37,59,35],[69,10,60,8,"socketService"],[69,23,60,21],[69,24,60,21,"default"],[69,31,60,21],[69,32,60,22,"connect"],[69,39,60,29],[69,40,60,30,"user"],[69,44,60,34],[69,45,60,35,"tenant_id"],[69,54,60,44],[69,56,60,46,"token"],[69,61,60,51],[69,62,60,52],[70,8,61,6],[71,8,63,6,"set"],[71,11,63,9],[71,12,63,10],[72,10,63,12,"user"],[72,14,63,16],[73,10,63,18,"isAuthenticated"],[73,25,63,33],[73,27,63,35],[73,31,63,39],[74,10,63,41,"isSubmitting"],[74,22,63,53],[74,24,63,55],[75,8,63,61],[75,9,63,62],[75,10,63,63],[77,8,65,6],[78,8,66,6,"setTimeout"],[78,18,66,16],[78,19,66,17],[78,25,66,23],[79,10,67,8,"get"],[79,13,67,11],[79,14,67,12],[79,15,67,13],[79,16,67,14,"initializePushNotifications"],[79,43,67,41],[79,44,67,42],[79,45,67,43],[80,8,68,6],[80,9,68,7],[80,11,68,9],[80,15,68,13],[80,16,68,14],[81,8,70,6],[81,15,70,13],[81,19,70,17],[82,6,71,4],[82,7,71,5],[82,8,71,6],[82,15,71,13,"error"],[82,20,71,23],[82,22,71,25],[83,8,72,6],[83,14,72,12,"message"],[83,21,72,19],[83,24,72,22,"error"],[83,29,72,27],[83,30,72,28,"response"],[83,38,72,36],[83,40,72,38,"data"],[83,44,72,42],[83,46,72,44,"detail"],[83,52,72,50],[83,56,72,54],[83,77,72,75],[84,8,73,6,"set"],[84,11,73,9],[84,12,73,10],[85,10,73,12,"error"],[85,15,73,17],[85,17,73,19,"message"],[85,24,73,26],[86,10,73,28,"isSubmitting"],[86,22,73,40],[86,24,73,42],[87,8,73,48],[87,9,73,49],[87,10,73,50],[88,8,74,6],[88,15,74,13],[88,20,74,18],[89,6,75,4],[90,4,76,2],[90,5,76,3],[91,4,78,2,"logout"],[91,10,78,8],[91,12,78,10],[91,18,78,10,"logout"],[91,19,78,10],[91,24,78,37],[92,6,79,4],[93,6,80,4],[93,12,80,10],[94,8,80,12,"pushToken"],[95,6,80,22],[95,7,80,23],[95,10,80,26,"get"],[95,13,80,29],[95,14,80,30],[95,15,80,31],[96,6,81,4],[96,10,81,8,"pushToken"],[96,19,81,17],[96,21,81,19],[97,8,82,6],[97,12,82,10],[98,10,83,8],[98,16,83,14,"pushApi"],[98,28,83,21],[98,29,83,21,"pushApi"],[98,36,83,21],[98,37,83,22,"deleteToken"],[98,48,83,33],[98,49,83,34,"pushToken"],[98,58,83,43],[98,59,83,44],[99,8,84,6],[99,9,84,7],[99,10,84,8],[99,17,84,15,"error"],[99,22,84,20],[99,24,84,22],[100,10,85,8,"console"],[100,17,85,15],[100,18,85,16,"error"],[100,23,85,21],[100,24,85,22],[100,61,85,59],[100,63,85,61,"error"],[100,68,85,66],[100,69,85,67],[101,8,86,6],[102,6,87,4],[104,6,89,4],[105,6,90,4],[105,10,90,8],[106,8,91,6],[106,14,91,12],[107,10,91,14,"pushNotificationService"],[108,8,91,38],[108,9,91,39],[108,12,91,42],[108,18,91,42,"require"],[108,25,91,42],[108,26,91,42,"_dependencyMap"],[108,40,91,42],[108,83,91,42,"_dependencyMap"],[108,97,91,42],[108,102,91,42,"_dependencyMap"],[108,116,91,42],[108,117,91,42,"paths"],[108,122,91,42],[108,156,91,87],[109,8,92,6,"pushNotificationService"],[109,31,92,29],[109,32,92,30,"cleanup"],[109,39,92,37],[109,40,92,38],[109,41,92,39],[110,6,93,4],[110,7,93,5],[110,8,93,6],[110,15,93,13,"error"],[110,20,93,18],[110,22,93,20],[111,8,94,6],[112,6,94,6],[113,6,97,4,"socketService"],[113,19,97,17],[113,20,97,17,"default"],[113,27,97,17],[113,28,97,18,"disconnect"],[113,38,97,28],[113,39,97,29],[113,40,97,30],[114,6,98,4],[114,12,98,10,"authApi"],[114,24,98,17],[114,25,98,17,"authApi"],[114,32,98,17],[114,33,98,18,"logout"],[114,39,98,24],[114,40,98,25],[114,41,98,26],[115,6,99,4,"set"],[115,9,99,7],[115,10,99,8],[116,8,99,10,"user"],[116,12,99,14],[116,14,99,16],[116,18,99,20],[117,8,99,22,"isAuthenticated"],[117,23,99,37],[117,25,99,39],[117,30,99,44],[118,8,99,46,"error"],[118,13,99,51],[118,15,99,53],[118,19,99,57],[119,8,99,59,"pushToken"],[119,17,99,68],[119,19,99,70],[120,6,99,75],[120,7,99,76],[120,8,99,77],[121,4,100,2],[121,5,100,3],[122,4,102,2,"checkAuth"],[122,13,102,11],[122,15,102,13],[122,21,102,13,"checkAuth"],[122,22,102,13],[122,27,102,43],[123,6,103,4,"set"],[123,9,103,7],[123,10,103,8],[124,8,103,10,"isInitializing"],[124,22,103,24],[124,24,103,26],[125,6,103,31],[125,7,103,32],[125,8,103,33],[126,6,104,4],[126,10,104,8],[127,8,105,6],[127,14,105,12,"token"],[127,19,105,17],[127,22,105,20],[127,28,105,26,"tokenManager"],[127,40,105,38],[127,41,105,38,"tokenManager"],[127,53,105,38],[127,54,105,39,"getAccessToken"],[127,68,105,53],[127,69,105,54],[127,70,105,55],[128,8,106,6],[128,12,106,10],[128,13,106,11,"token"],[128,18,106,16],[128,20,106,18],[129,10,107,8,"set"],[129,13,107,11],[129,14,107,12],[130,12,107,14,"isInitializing"],[130,26,107,28],[130,28,107,30],[130,33,107,35],[131,12,107,37,"isAuthenticated"],[131,27,107,52],[131,29,107,54],[132,10,107,60],[132,11,107,61],[132,12,107,62],[133,10,108,8],[133,17,108,15],[133,22,108,20],[134,8,109,6],[135,8,111,6],[135,14,111,12,"user"],[135,18,111,16],[135,21,111,19],[135,27,111,25,"authApi"],[135,39,111,32],[135,40,111,32,"authApi"],[135,47,111,32],[135,48,111,33,"getCurrentUser"],[135,62,111,47],[135,63,111,48],[135,64,111,49],[137,8,113,6],[138,8,114,6],[138,12,114,10,"user"],[138,16,114,14],[138,17,114,15,"tenant_id"],[138,26,114,24],[138,28,114,26],[139,10,115,8,"socketService"],[139,23,115,21],[139,24,115,21,"default"],[139,31,115,21],[139,32,115,22,"connect"],[139,39,115,29],[139,40,115,30,"user"],[139,44,115,34],[139,45,115,35,"tenant_id"],[139,54,115,44],[139,56,115,46,"token"],[139,61,115,51],[139,62,115,52],[140,8,116,6],[141,8,118,6,"set"],[141,11,118,9],[141,12,118,10],[142,10,118,12,"user"],[142,14,118,16],[143,10,118,18,"isAuthenticated"],[143,25,118,33],[143,27,118,35],[143,31,118,39],[144,10,118,41,"isInitializing"],[144,24,118,55],[144,26,118,57],[145,8,118,63],[145,9,118,64],[145,10,118,65],[147,8,120,6],[148,8,121,6,"setTimeout"],[148,18,121,16],[148,19,121,17],[148,25,121,23],[149,10,122,8,"get"],[149,13,122,11],[149,14,122,12],[149,15,122,13],[149,16,122,14,"initializePushNotifications"],[149,43,122,41],[149,44,122,42],[149,45,122,43],[150,8,123,6],[150,9,123,7],[150,11,123,9],[150,15,123,13],[150,16,123,14],[151,8,125,6],[151,15,125,13],[151,19,125,17],[152,6,126,4],[152,7,126,5],[152,8,126,6],[152,15,126,13,"error"],[152,20,126,18],[152,22,126,20],[153,8,127,6],[153,14,127,12,"tokenManager"],[153,26,127,24],[153,27,127,24,"tokenManager"],[153,39,127,24],[153,40,127,25,"clearTokens"],[153,51,127,36],[153,52,127,37],[153,53,127,38],[154,8,128,6,"set"],[154,11,128,9],[154,12,128,10],[155,10,128,12,"user"],[155,14,128,16],[155,16,128,18],[155,20,128,22],[156,10,128,24,"isAuthenticated"],[156,25,128,39],[156,27,128,41],[156,32,128,46],[157,10,128,48,"isInitializing"],[157,24,128,62],[157,26,128,64],[158,8,128,70],[158,9,128,71],[158,10,128,72],[159,8,129,6],[159,15,129,13],[159,20,129,18],[160,6,130,4],[161,4,131,2],[161,5,131,3],[162,4,133,2,"clearError"],[162,14,133,12],[162,16,133,14,"clearError"],[162,17,133,14],[162,22,133,20,"set"],[162,25,133,23],[162,26,133,24],[163,6,133,26,"error"],[163,11,133,31],[163,13,133,33],[164,4,133,38],[164,5,133,39],[165,2,134,0],[165,3,134,1],[165,4,134,2],[165,5,134,3],[166,0,134,4],[166,3]],"functionMap":{"names":["<global>","create$argument_0","initializePushNotifications","login","setTimeout$argument_0","logout","checkAuth","clearError"],"mappings":"AAA;8CCsB;+BCQ;GDkB;SEE;iBCe;ODE;GFQ;UIE;GJsB;aKE;iBFmB;OEE;GLQ;cME,0BN;EDC"},"hasCjsExports":false},"type":"js/module"}]}