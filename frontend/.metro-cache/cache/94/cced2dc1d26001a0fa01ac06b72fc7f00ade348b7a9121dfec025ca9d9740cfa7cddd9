{"dependencies":[{"name":"zustand","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":33,"index":33}}],"key":"POPvx7yS3Y3wz+S/9OAefiXNs0Q=","exportNames":["*"],"imports":1}},{"name":"../services/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":67},"end":{"line":3,"column":65,"index":132}}],"key":"Pr5/EB33W7mJGi+ygccy+pUf1E8=","exportNames":["*"],"imports":1}},{"name":"../services/socket","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":133},"end":{"line":4,"column":47,"index":180}}],"key":"Zr9DRnwDVZxHFeGDyPwyujLo6pk=","exportNames":["*"],"imports":1}},{"name":"../services/pushNotifications","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":181},"end":{"line":5,"column":68,"index":249}}],"key":"6td5MWdMBsLZGNw4Rn9RJgT3xXw=","exportNames":["*"],"imports":1}},{"name":"react-native-web/dist/exports/Platform","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dV3bI3NOD8bfMzaIniMaFGy/nn8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"useAuthStore\", {\n    enumerable: true,\n    get: function () {\n      return useAuthStore;\n    }\n  });\n  var _zustand = require(_dependencyMap[0], \"zustand\");\n  var _servicesApi = require(_dependencyMap[1], \"../services/api\");\n  var _servicesSocket = require(_dependencyMap[2], \"../services/socket\");\n  var socketService = _interopDefault(_servicesSocket);\n  var _servicesPushNotifications = require(_dependencyMap[3], \"../services/pushNotifications\");\n  var pushNotificationService = _interopDefault(_servicesPushNotifications);\n  var _reactNativeWebDistExportsPlatform = require(_dependencyMap[4], \"react-native-web/dist/exports/Platform\");\n  var Platform = _interopDefault(_reactNativeWebDistExportsPlatform);\n  const useAuthStore = (0, _zustand.create)((set, get) => ({\n    user: null,\n    isAuthenticated: false,\n    isInitializing: true,\n    isSubmitting: false,\n    error: null,\n    pushToken: null,\n    initializePushNotifications: async () => {\n      try {\n        const token = await pushNotificationService.default.initialize();\n        if (token) {\n          set({\n            pushToken: token\n          });\n          // Register the token with the backend\n          try {\n            await _servicesApi.pushApi.registerToken(token, Platform.default.OS);\n            console.log('[Auth] Push token registered with backend');\n          } catch (error) {\n            console.error('[Auth] Failed to register push token:', error);\n          }\n        }\n      } catch (error) {\n        console.error('[Auth] Failed to initialize push notifications:', error);\n      }\n    },\n    login: async (email, password) => {\n      set({\n        isSubmitting: true,\n        error: null\n      });\n      try {\n        await _servicesApi.authApi.login({\n          email,\n          password\n        });\n        const user = await _servicesApi.authApi.getCurrentUser();\n\n        // Connect to WebSocket\n        const token = await _servicesApi.tokenManager.getAccessToken();\n        if (user.tenant_id && token) {\n          socketService.default.connect(user.tenant_id, token);\n        }\n        set({\n          user,\n          isAuthenticated: true,\n          isSubmitting: false\n        });\n\n        // Initialize push notifications after successful login\n        get().initializePushNotifications();\n        return true;\n      } catch (error) {\n        const message = error.response?.data?.detail || 'Erreur de connexion';\n        set({\n          error: message,\n          isSubmitting: false\n        });\n        return false;\n      }\n    },\n    logout: async () => {\n      // Unregister push token before logout\n      const {\n        pushToken\n      } = get();\n      if (pushToken) {\n        try {\n          await _servicesApi.pushApi.deleteToken(pushToken);\n        } catch (error) {\n          console.error('[Auth] Failed to delete push token:', error);\n        }\n      }\n      socketService.default.disconnect();\n      pushNotificationService.default.cleanup();\n      await _servicesApi.authApi.logout();\n      set({\n        user: null,\n        isAuthenticated: false,\n        error: null,\n        pushToken: null\n      });\n    },\n    checkAuth: async () => {\n      set({\n        isInitializing: true\n      });\n      try {\n        const token = await _servicesApi.tokenManager.getAccessToken();\n        if (!token) {\n          set({\n            isInitializing: false,\n            isAuthenticated: false\n          });\n          return false;\n        }\n        const user = await _servicesApi.authApi.getCurrentUser();\n\n        // Connect to WebSocket\n        if (user.tenant_id) {\n          socketService.default.connect(user.tenant_id, token);\n        }\n        set({\n          user,\n          isAuthenticated: true,\n          isInitializing: false\n        });\n\n        // Initialize push notifications\n        get().initializePushNotifications();\n        return true;\n      } catch (error) {\n        await _servicesApi.tokenManager.clearTokens();\n        set({\n          user: null,\n          isAuthenticated: false,\n          isInitializing: false\n        });\n        return false;\n      }\n    },\n    clearError: () => set({\n      error: null\n    })\n  }));\n});","lineCount":151,"map":[[12,2,24,0,"Object"],[12,8,24,0],[12,9,24,0,"defineProperty"],[12,23,24,0],[12,24,24,0,"exports"],[12,31,24,0],[13,4,24,0,"enumerable"],[13,14,24,0],[14,4,24,0,"get"],[14,7,24,0],[14,18,24,0,"get"],[14,19,24,0],[15,6,24,0],[15,13,24,0,"useAuthStore"],[15,25,24,0],[16,4,24,0],[17,2,24,0],[18,2,1,0],[18,6,1,0,"_zustand"],[18,14,1,0],[18,17,1,0,"require"],[18,24,1,0],[18,25,1,0,"_dependencyMap"],[18,39,1,0],[19,2,3,0],[19,6,3,0,"_servicesApi"],[19,18,3,0],[19,21,3,0,"require"],[19,28,3,0],[19,29,3,0,"_dependencyMap"],[19,43,3,0],[20,2,4,0],[20,6,4,0,"_servicesSocket"],[20,21,4,0],[20,24,4,0,"require"],[20,31,4,0],[20,32,4,0,"_dependencyMap"],[20,46,4,0],[21,2,4,0],[21,6,4,0,"socketService"],[21,19,4,0],[21,22,4,0,"_interopDefault"],[21,37,4,0],[21,38,4,0,"_servicesSocket"],[21,53,4,0],[22,2,5,0],[22,6,5,0,"_servicesPushNotifications"],[22,32,5,0],[22,35,5,0,"require"],[22,42,5,0],[22,43,5,0,"_dependencyMap"],[22,57,5,0],[23,2,5,0],[23,6,5,0,"pushNotificationService"],[23,29,5,0],[23,32,5,0,"_interopDefault"],[23,47,5,0],[23,48,5,0,"_servicesPushNotifications"],[23,74,5,0],[24,2,5,68],[24,6,5,68,"_reactNativeWebDistExportsPlatform"],[24,40,5,68],[24,43,5,68,"require"],[24,50,5,68],[24,51,5,68,"_dependencyMap"],[24,65,5,68],[25,2,5,68],[25,6,5,68,"Platform"],[25,14,5,68],[25,17,5,68,"_interopDefault"],[25,32,5,68],[25,33,5,68,"_reactNativeWebDistExportsPlatform"],[25,67,5,68],[26,2,24,7],[26,8,24,13,"useAuthStore"],[26,20,24,25],[26,23,24,28],[26,27,24,28,"create"],[26,35,24,34],[26,36,24,34,"create"],[26,42,24,34],[26,44,24,46],[26,45,24,47,"set"],[26,48,24,50],[26,50,24,52,"get"],[26,53,24,55],[26,59,24,61],[27,4,25,2,"user"],[27,8,25,6],[27,10,25,8],[27,14,25,12],[28,4,26,2,"isAuthenticated"],[28,19,26,17],[28,21,26,19],[28,26,26,24],[29,4,27,2,"isInitializing"],[29,18,27,16],[29,20,27,18],[29,24,27,22],[30,4,28,2,"isSubmitting"],[30,16,28,14],[30,18,28,16],[30,23,28,21],[31,4,29,2,"error"],[31,9,29,7],[31,11,29,9],[31,15,29,13],[32,4,30,2,"pushToken"],[32,13,30,11],[32,15,30,13],[32,19,30,17],[33,4,32,2,"initializePushNotifications"],[33,31,32,29],[33,33,32,31],[33,39,32,31,"initializePushNotifications"],[33,40,32,31],[33,45,32,43],[34,6,33,4],[34,10,33,8],[35,8,34,6],[35,14,34,12,"token"],[35,19,34,17],[35,22,34,20],[35,28,34,26,"pushNotificationService"],[35,51,34,49],[35,52,34,49,"default"],[35,59,34,49],[35,60,34,50,"initialize"],[35,70,34,60],[35,71,34,61],[35,72,34,62],[36,8,35,6],[36,12,35,10,"token"],[36,17,35,15],[36,19,35,17],[37,10,36,8,"set"],[37,13,36,11],[37,14,36,12],[38,12,36,14,"pushToken"],[38,21,36,23],[38,23,36,25,"token"],[39,10,36,31],[39,11,36,32],[39,12,36,33],[40,10,37,8],[41,10,38,8],[41,14,38,12],[42,12,39,10],[42,18,39,16,"pushApi"],[42,30,39,23],[42,31,39,23,"pushApi"],[42,38,39,23],[42,39,39,24,"registerToken"],[42,52,39,37],[42,53,39,38,"token"],[42,58,39,43],[42,60,39,45,"Platform"],[42,68,39,53],[42,69,39,53,"default"],[42,76,39,53],[42,77,39,54,"OS"],[42,79,39,56],[42,80,39,57],[43,12,40,10,"console"],[43,19,40,17],[43,20,40,18,"log"],[43,23,40,21],[43,24,40,22],[43,67,40,65],[43,68,40,66],[44,10,41,8],[44,11,41,9],[44,12,41,10],[44,19,41,17,"error"],[44,24,41,22],[44,26,41,24],[45,12,42,10,"console"],[45,19,42,17],[45,20,42,18,"error"],[45,25,42,23],[45,26,42,24],[45,65,42,63],[45,67,42,65,"error"],[45,72,42,70],[45,73,42,71],[46,10,43,8],[47,8,44,6],[48,6,45,4],[48,7,45,5],[48,8,45,6],[48,15,45,13,"error"],[48,20,45,18],[48,22,45,20],[49,8,46,6,"console"],[49,15,46,13],[49,16,46,14,"error"],[49,21,46,19],[49,22,46,20],[49,71,46,69],[49,73,46,71,"error"],[49,78,46,76],[49,79,46,77],[50,6,47,4],[51,4,48,2],[51,5,48,3],[52,4,50,2,"login"],[52,9,50,7],[52,11,50,9],[52,17,50,9,"login"],[52,18,50,16,"email"],[52,23,50,29],[52,25,50,31,"password"],[52,33,50,47],[52,38,50,70],[53,6,51,4,"set"],[53,9,51,7],[53,10,51,8],[54,8,51,10,"isSubmitting"],[54,20,51,22],[54,22,51,24],[54,26,51,28],[55,8,51,30,"error"],[55,13,51,35],[55,15,51,37],[56,6,51,42],[56,7,51,43],[56,8,51,44],[57,6,52,4],[57,10,52,8],[58,8,53,6],[58,14,53,12,"authApi"],[58,26,53,19],[58,27,53,19,"authApi"],[58,34,53,19],[58,35,53,20,"login"],[58,40,53,25],[58,41,53,26],[59,10,53,28,"email"],[59,15,53,33],[60,10,53,35,"password"],[61,8,53,44],[61,9,53,45],[61,10,53,46],[62,8,54,6],[62,14,54,12,"user"],[62,18,54,16],[62,21,54,19],[62,27,54,25,"authApi"],[62,39,54,32],[62,40,54,32,"authApi"],[62,47,54,32],[62,48,54,33,"getCurrentUser"],[62,62,54,47],[62,63,54,48],[62,64,54,49],[64,8,56,6],[65,8,57,6],[65,14,57,12,"token"],[65,19,57,17],[65,22,57,20],[65,28,57,26,"tokenManager"],[65,40,57,38],[65,41,57,38,"tokenManager"],[65,53,57,38],[65,54,57,39,"getAccessToken"],[65,68,57,53],[65,69,57,54],[65,70,57,55],[66,8,58,6],[66,12,58,10,"user"],[66,16,58,14],[66,17,58,15,"tenant_id"],[66,26,58,24],[66,30,58,28,"token"],[66,35,58,33],[66,37,58,35],[67,10,59,8,"socketService"],[67,23,59,21],[67,24,59,21,"default"],[67,31,59,21],[67,32,59,22,"connect"],[67,39,59,29],[67,40,59,30,"user"],[67,44,59,34],[67,45,59,35,"tenant_id"],[67,54,59,44],[67,56,59,46,"token"],[67,61,59,51],[67,62,59,52],[68,8,60,6],[69,8,62,6,"set"],[69,11,62,9],[69,12,62,10],[70,10,62,12,"user"],[70,14,62,16],[71,10,62,18,"isAuthenticated"],[71,25,62,33],[71,27,62,35],[71,31,62,39],[72,10,62,41,"isSubmitting"],[72,22,62,53],[72,24,62,55],[73,8,62,61],[73,9,62,62],[73,10,62,63],[75,8,64,6],[76,8,65,6,"get"],[76,11,65,9],[76,12,65,10],[76,13,65,11],[76,14,65,12,"initializePushNotifications"],[76,41,65,39],[76,42,65,40],[76,43,65,41],[77,8,67,6],[77,15,67,13],[77,19,67,17],[78,6,68,4],[78,7,68,5],[78,8,68,6],[78,15,68,13,"error"],[78,20,68,23],[78,22,68,25],[79,8,69,6],[79,14,69,12,"message"],[79,21,69,19],[79,24,69,22,"error"],[79,29,69,27],[79,30,69,28,"response"],[79,38,69,36],[79,40,69,38,"data"],[79,44,69,42],[79,46,69,44,"detail"],[79,52,69,50],[79,56,69,54],[79,77,69,75],[80,8,70,6,"set"],[80,11,70,9],[80,12,70,10],[81,10,70,12,"error"],[81,15,70,17],[81,17,70,19,"message"],[81,24,70,26],[82,10,70,28,"isSubmitting"],[82,22,70,40],[82,24,70,42],[83,8,70,48],[83,9,70,49],[83,10,70,50],[84,8,71,6],[84,15,71,13],[84,20,71,18],[85,6,72,4],[86,4,73,2],[86,5,73,3],[87,4,75,2,"logout"],[87,10,75,8],[87,12,75,10],[87,18,75,10,"logout"],[87,19,75,10],[87,24,75,37],[88,6,76,4],[89,6,77,4],[89,12,77,10],[90,8,77,12,"pushToken"],[91,6,77,22],[91,7,77,23],[91,10,77,26,"get"],[91,13,77,29],[91,14,77,30],[91,15,77,31],[92,6,78,4],[92,10,78,8,"pushToken"],[92,19,78,17],[92,21,78,19],[93,8,79,6],[93,12,79,10],[94,10,80,8],[94,16,80,14,"pushApi"],[94,28,80,21],[94,29,80,21,"pushApi"],[94,36,80,21],[94,37,80,22,"deleteToken"],[94,48,80,33],[94,49,80,34,"pushToken"],[94,58,80,43],[94,59,80,44],[95,8,81,6],[95,9,81,7],[95,10,81,8],[95,17,81,15,"error"],[95,22,81,20],[95,24,81,22],[96,10,82,8,"console"],[96,17,82,15],[96,18,82,16,"error"],[96,23,82,21],[96,24,82,22],[96,61,82,59],[96,63,82,61,"error"],[96,68,82,66],[96,69,82,67],[97,8,83,6],[98,6,84,4],[99,6,86,4,"socketService"],[99,19,86,17],[99,20,86,17,"default"],[99,27,86,17],[99,28,86,18,"disconnect"],[99,38,86,28],[99,39,86,29],[99,40,86,30],[100,6,87,4,"pushNotificationService"],[100,29,87,27],[100,30,87,27,"default"],[100,37,87,27],[100,38,87,28,"cleanup"],[100,45,87,35],[100,46,87,36],[100,47,87,37],[101,6,88,4],[101,12,88,10,"authApi"],[101,24,88,17],[101,25,88,17,"authApi"],[101,32,88,17],[101,33,88,18,"logout"],[101,39,88,24],[101,40,88,25],[101,41,88,26],[102,6,89,4,"set"],[102,9,89,7],[102,10,89,8],[103,8,89,10,"user"],[103,12,89,14],[103,14,89,16],[103,18,89,20],[104,8,89,22,"isAuthenticated"],[104,23,89,37],[104,25,89,39],[104,30,89,44],[105,8,89,46,"error"],[105,13,89,51],[105,15,89,53],[105,19,89,57],[106,8,89,59,"pushToken"],[106,17,89,68],[106,19,89,70],[107,6,89,75],[107,7,89,76],[107,8,89,77],[108,4,90,2],[108,5,90,3],[109,4,92,2,"checkAuth"],[109,13,92,11],[109,15,92,13],[109,21,92,13,"checkAuth"],[109,22,92,13],[109,27,92,43],[110,6,93,4,"set"],[110,9,93,7],[110,10,93,8],[111,8,93,10,"isInitializing"],[111,22,93,24],[111,24,93,26],[112,6,93,31],[112,7,93,32],[112,8,93,33],[113,6,94,4],[113,10,94,8],[114,8,95,6],[114,14,95,12,"token"],[114,19,95,17],[114,22,95,20],[114,28,95,26,"tokenManager"],[114,40,95,38],[114,41,95,38,"tokenManager"],[114,53,95,38],[114,54,95,39,"getAccessToken"],[114,68,95,53],[114,69,95,54],[114,70,95,55],[115,8,96,6],[115,12,96,10],[115,13,96,11,"token"],[115,18,96,16],[115,20,96,18],[116,10,97,8,"set"],[116,13,97,11],[116,14,97,12],[117,12,97,14,"isInitializing"],[117,26,97,28],[117,28,97,30],[117,33,97,35],[118,12,97,37,"isAuthenticated"],[118,27,97,52],[118,29,97,54],[119,10,97,60],[119,11,97,61],[119,12,97,62],[120,10,98,8],[120,17,98,15],[120,22,98,20],[121,8,99,6],[122,8,101,6],[122,14,101,12,"user"],[122,18,101,16],[122,21,101,19],[122,27,101,25,"authApi"],[122,39,101,32],[122,40,101,32,"authApi"],[122,47,101,32],[122,48,101,33,"getCurrentUser"],[122,62,101,47],[122,63,101,48],[122,64,101,49],[124,8,103,6],[125,8,104,6],[125,12,104,10,"user"],[125,16,104,14],[125,17,104,15,"tenant_id"],[125,26,104,24],[125,28,104,26],[126,10,105,8,"socketService"],[126,23,105,21],[126,24,105,21,"default"],[126,31,105,21],[126,32,105,22,"connect"],[126,39,105,29],[126,40,105,30,"user"],[126,44,105,34],[126,45,105,35,"tenant_id"],[126,54,105,44],[126,56,105,46,"token"],[126,61,105,51],[126,62,105,52],[127,8,106,6],[128,8,108,6,"set"],[128,11,108,9],[128,12,108,10],[129,10,108,12,"user"],[129,14,108,16],[130,10,108,18,"isAuthenticated"],[130,25,108,33],[130,27,108,35],[130,31,108,39],[131,10,108,41,"isInitializing"],[131,24,108,55],[131,26,108,57],[132,8,108,63],[132,9,108,64],[132,10,108,65],[134,8,110,6],[135,8,111,6,"get"],[135,11,111,9],[135,12,111,10],[135,13,111,11],[135,14,111,12,"initializePushNotifications"],[135,41,111,39],[135,42,111,40],[135,43,111,41],[136,8,113,6],[136,15,113,13],[136,19,113,17],[137,6,114,4],[137,7,114,5],[137,8,114,6],[137,15,114,13,"error"],[137,20,114,18],[137,22,114,20],[138,8,115,6],[138,14,115,12,"tokenManager"],[138,26,115,24],[138,27,115,24,"tokenManager"],[138,39,115,24],[138,40,115,25,"clearTokens"],[138,51,115,36],[138,52,115,37],[138,53,115,38],[139,8,116,6,"set"],[139,11,116,9],[139,12,116,10],[140,10,116,12,"user"],[140,14,116,16],[140,16,116,18],[140,20,116,22],[141,10,116,24,"isAuthenticated"],[141,25,116,39],[141,27,116,41],[141,32,116,46],[142,10,116,48,"isInitializing"],[142,24,116,62],[142,26,116,64],[143,8,116,70],[143,9,116,71],[143,10,116,72],[144,8,117,6],[144,15,117,13],[144,20,117,18],[145,6,118,4],[146,4,119,2],[146,5,119,3],[147,4,121,2,"clearError"],[147,14,121,12],[147,16,121,14,"clearError"],[147,17,121,14],[147,22,121,20,"set"],[147,25,121,23],[147,26,121,24],[148,6,121,26,"error"],[148,11,121,31],[148,13,121,33],[149,4,121,38],[149,5,121,39],[150,2,122,0],[150,3,122,1],[150,4,122,2],[150,5,122,3],[151,0,122,4],[151,3]],"functionMap":{"names":["<global>","create$argument_0","initializePushNotifications","login","logout","checkAuth","clearError"],"mappings":"AAA;8CCuB;+BCQ;GDgB;SEE;GFuB;UGE;GHe;aIE;GJ2B;cKE,0BL;EDC"},"hasCjsExports":false},"type":"js/module"}]}